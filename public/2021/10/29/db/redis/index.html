<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>小王子失去了玫瑰花</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="redis123author: WuDGdatetime： 10:4040 星期二 2021年8月3日position： 杭州乐佳大厦&#x2F;博彦  我曾七次鄙视自己的灵魂第一次，当它本可进取时，却故作谦卑；第二次，当它在空虚时，用爱欲来填充；第三次，在困难和容易之间，它选择了容易；第四次，它犯了错，却借由别人也会犯错来宽慰自己；第五次，它自由软弱，却把它认为是生命的坚韧；第六次，当它鄙夷一张丑恶的嘴脸">
<meta property="og:type" content="article">
<meta property="og:title" content="小王子失去了玫瑰花">
<meta property="og:url" content="http://example.com/2021/10/29/db/redis/index.html">
<meta property="og:site_name" content="小王子失去了玫瑰花">
<meta property="og:description" content="redis123author: WuDGdatetime： 10:4040 星期二 2021年8月3日position： 杭州乐佳大厦&#x2F;博彦  我曾七次鄙视自己的灵魂第一次，当它本可进取时，却故作谦卑；第二次，当它在空虚时，用爱欲来填充；第三次，在困难和容易之间，它选择了容易；第四次，它犯了错，却借由别人也会犯错来宽慰自己；第五次，它自由软弱，却把它认为是生命的坚韧；第六次，当它鄙夷一张丑恶的嘴脸">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-10-29T14:26:47.444Z">
<meta property="article:modified_time" content="2021-08-23T06:53:20.000Z">
<meta property="article:author" content="DiGuang Wu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="小王子失去了玫瑰花" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">小王子失去了玫瑰花</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">骗你的，没失去~</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-db/redis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/29/db/redis/" class="article-date">
  <time class="dt-published" datetime="2021-10-29T14:26:47.444Z" itemprop="datePublished">2021-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="redis"><a href="#redis" class="headerlink" title="redis"></a>redis</h1><figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">author: WuDG</span><br><span class="line">datetime： 10:4040 星期二 2021年8月3日</span><br><span class="line">position： 杭州乐佳大厦/博彦</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我曾七次鄙视自己的灵魂<br>第一次，当它本可进取时，却故作谦卑；<br>第二次，当它在空虚时，用爱欲来填充；<br>第三次，在困难和容易之间，它选择了容易；<br>第四次，它犯了错，却借由别人也会犯错来宽慰自己；<br>第五次，它自由软弱，却把它认为是生命的坚韧；<br>第六次，当它鄙夷一张丑恶的嘴脸时，却不知那正是自己面具中的一副；<br>第七次，它侧身于生活的污泥中，虽不甘心，却又畏首畏尾。 </p>
</blockquote>
<h2 id="一、redis-概述-amp-redis-特点"><a href="#一、redis-概述-amp-redis-特点" class="headerlink" title="一、redis 概述 &amp; redis 特点"></a>一、redis 概述 &amp; redis 特点</h2><blockquote>
<p>Redis（Remote Dictionary Server）远程数据服务，是一种支持 key-value 等多种数据结构的存储系统。可用于缓存，事件发布或订阅，高速队列等场景。支持网络，提供 string，hash，list，set，zset 等数据结构，基于内存，可持久化</p>
</blockquote>
<ul>
<li>丰富的数据类型：适用场景多</li>
<li>内存存储：快</li>
<li>持久化：数据安全</li>
</ul>
<h2 id="二、数据结构"><a href="#二、数据结构" class="headerlink" title="二、数据结构"></a>二、数据结构</h2><blockquote>
<p>redis 是 key-value 数据库，key 只能是 string，value 可以是 string、hash、list、set、 sorted set</p>
</blockquote>
<ul>
<li>string：最大存储 512m（set key_name value），信息缓存、计数器、分布式锁</li>
<li>hash：适合存储对象，key-value 集合(hset key_name field value)，购物车（用户id为key，商品id为field，商品数量为value）</li>
<li>list：字符串列表，有序可重复（lpush key_name value1.. value10），是一个分页做定时排行榜</li>
<li>set：字符串无序不可重复集合（sadd key_name value…），收藏夹</li>
<li>sorted set：有序集合（zadd key_name score value），实时排行榜</li>
</ul>
<h2 id="三、redis-持久化策略"><a href="#三、redis-持久化策略" class="headerlink" title="三、redis 持久化策略"></a>三、redis 持久化策略</h2><blockquote>
<p>将内存中数据存储到磁盘中</p>
</blockquote>
<ul>
<li>RDB：快照存储</li>
<li>AOF：记录写操作，追加到日志文件中，服务器重启时重新执行这些命令</li>
<li>不使用持久化</li>
<li>RDB&amp;AOF：同时开启两种持久化，redis重启时优先载入 AOP 文件来恢复原始数据，AOF中数据比RDB更加完整</li>
</ul>
<h2 id="四、redis-线程模型"><a href="#四、redis-线程模型" class="headerlink" title="四、redis 线程模型"></a>四、redis 线程模型</h2><p>redis 内部使用文件处理器，单线程架构。采用 IO 多路复用机制同时监听多个 socket，根据 socket 上的事件选择对应的事件处理器进行处理<br>单线程高效率：</p>
<ul>
<li>纯内存操作</li>
<li>核心是基于非阻塞的 IO 多路复用机制</li>
<li>单线程避免了多线程上下文切换</li>
</ul>
<h2 id="五、常见问题"><a href="#五、常见问题" class="headerlink" title="五、常见问题"></a>五、常见问题</h2><ul>
<li>雪崩：缓存中大批量 key 过期，请求直接落到数据库。使 key 过期时间均匀，加互斥锁，用不国旗</li>
<li>穿透：恶意请求系统中不存在的数据。使用布隆过滤器（爬虫系统url去重、垃圾邮件过滤、黑名单），返回空对象</li>
<li>预热：系统上线后将缓存数据直接加载到缓存系统，避免用户请求直接落到数据库再写到缓存。工程启动时进行加载缓存动作，设置一个定时任务脚本，先保证热点数据提前加载到缓存</li>
<li>击穿：某热点 key 失效瞬间，请求直接落到数据库。增加回血缓存互斥锁，热点 key 永不过期</li>
<li>降级：指缓存失效或者服务器挂掉，不直接访问数据库，直接返回默认值或者访问服务的内存数据，避免数据库遭受巨大压力</li>
</ul>
<h2 id="六、内存淘汰机制"><a href="#六、内存淘汰机制" class="headerlink" title="六、内存淘汰机制"></a>六、内存淘汰机制</h2><blockquote>
<p>redis 缓存不足时，通过淘汰旧数据来处理新加入数据的策略</p>
</blockquote>
<ul>
<li>noeviction：默认策略，对于写请求直接返回错误</li>
<li>allkeys-lru：所有 key 最近最少使用</li>
<li>volatile-rlu：设置了过期时间的 key 最近最少使用</li>
<li>allkeys-random：所有 key 中随机淘汰</li>
<li>volatile-random：从设置了过期时间的 key 中随机淘汰</li>
<li>volatile-ttl：在设计了过期时间的 key 中根据过期时间淘汰最早过期的 key</li>
<li>allkeys-lfu：所有的 key 中，最少使用频率，4.0开始支持</li>
<li>volatile-lfu：设置了过期时间的 key 中，最少使用频率，4.0开始支持</li>
</ul>
<h2 id="七、redis事务机制"><a href="#七、redis事务机制" class="headerlink" title="七、redis事务机制"></a>七、redis事务机制</h2><blockquote>
<p>MULTI 开启，操作命令加入队列，EXEC 命令开始顺序执行。如果执行报错，不会回滚</p>
</blockquote>
<ul>
<li>WATCH：为 redis 提供 check-and-set（CAS）行为。被 WATCH 的 key 如果被改动，则 EXEC 时会返回 nil-reply</li>
<li>MULTI：开启一个事务</li>
<li>UNWATCH：取消 WATCH 命令所有的 key</li>
<li>DISCARD：放弃事务，事务列表被清空，并退出事务状态</li>
<li>EXEC：负责执行事务中所有命令</li>
</ul>
<h2 id="八、redis-主从复制"><a href="#八、redis-主从复制" class="headerlink" title="八、redis 主从复制"></a>八、redis 主从复制</h2><blockquote>
<p>指将一台 redis 服务器数据复制到其他 redis 服务器。前者为主节点（master），后者为从节点（slave）。数据的复制是单向的，只能由主到从</p>
</blockquote>
<p>主从复制作用：</p>
<ul>
<li>数据荣誉：热数据备份</li>
<li>故障恢复：主节点故障，可以由从节点提供服务</li>
<li>负载均衡：读写分离，主节点负责写数据，从节点负责读数据</li>
<li>高可用：是哨兵和集群的基础</li>
</ul>
<p>实现原理：</p>
<blockquote>
<p>三个阶段：连接建立阶段、数据同步阶段、命令传播阶段</p>
</blockquote>
<h2 id="九、哨兵（Sentinel）原理"><a href="#九、哨兵（Sentinel）原理" class="headerlink" title="九、哨兵（Sentinel）原理"></a>九、哨兵（Sentinel）原理</h2><blockquote>
<p>是 redis 高可用的实现方案，管理多个 redis 实例，实现对 redis 的监控、通知、自动故障转移</p>
</blockquote>
<p>问题引入：redis 主从负责模式下，一旦主节点故障无法提供服务，需要手动将从节点晋升为主节点，还需要通知客户端更新主节点地址，这个故障处理方案是不可取的</p>
<h2 id="十、-memcache-amp-redis-区别"><a href="#十、-memcache-amp-redis-区别" class="headerlink" title="十、 memcache &amp; redis 区别"></a>十、 memcache &amp; redis 区别</h2><ul>
<li>memcache 纯内存，数据量不能超过内存，redis 支持持久化</li>
<li>memcache 只支持 string，redis 支持多种</li>
</ul>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h2><ul>
<li>Jedis</li>
<li>Redisson</li>
<li>Lettuce</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/10/29/db/redis/" data-id="ckvcgyeks000crsuo0ftr0trb" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/10/29/framework/spring/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2021/10/29/core/linux/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/29/java/jvm/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/10/29/java/juc/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/10/29/java/java%20se/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/10/29/framework/spring/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/10/29/db/redis/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 DiGuang Wu<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>